<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Painel Elite V3</title>
    <style>
        :root { --primary: #ff003c; --secondary: #00f2ff; --bg: #050505; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background: var(--bg); color: white; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* Cabeçalho */
        header { padding: 20px; text-align: center; border-bottom: 1px solid #222; }
        h2 { color: var(--primary); font-size: 18px; text-transform: uppercase; letter-spacing: 2px; }

        /* Área de Teste da Mira (Onde o código do enginebundle atua) */
        #touch-area {
            flex-grow: 1;
            margin: 15px;
            border: 2px dashed #333;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background: radial-gradient(circle, rgba(255,0,60,0.05) 0%, transparent 70%);
        }
        #aim-pointer {
            width: 10px; height: 10px;
            background: var(--secondary);
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 0 15px var(--secondary);
            pointer-events: none;
        }

        /* Controles */
        .controls { padding: 20px; background: rgba(15,15,15,0.95); border-radius: 20px 20px 0 0; border-top: 1px solid #333; }
        .card { background: #111; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #222; }
        label { display: block; font-size: 10px; color: #aaa; margin-bottom: 8px; }
        label span { float: right; color: var(--primary); }
        input[type="range"] { width: 100%; accent-color: var(--primary); }
    </style>
</head>
<body>

<header>
    <h2>FF ELITE ENGINE</h2>
</header>

<div id="touch-area">
    <div id="aim-pointer"></div>
    <p style="color: #444; font-size: 12px;">DESLIZE AQUI PARA TESTAR A MIRA</p>
</div>

<div class="controls">
    <div class="card">
        <label>VELOCIDADE MÁXIMA (CLAMP): <span id="valMaxVel">25</span></label>
        <input type="range" min="10" max="100" value="25" id="sliderMaxVel" oninput="updateEngine()">
        
        <label style="margin-top:15px;">PRECISÃO (THRESHOLD): <span id="valPrec">2.5</span></label>
        <input type="range" min="1" max="10" step="0.5" value="2.5" id="sliderPrec" oninput="updateEngine()">
    </div>
    
    <p id="status-sw" style="font-size: 9px; text-align: center; color: #444;">OFFLINE READY: PENDING</p>
</div>

<script>
// --- 1. LÓGICA DO ENGINE (engine.js) ---
const aimEngine = {
    maxVelocity: 25,
    precisionThreshold: 2.5,
    ALPHA: 0.25,
    filteredDelta: 0,
    
    cubicBezier: function(t) {
        const p1 = 0.15, p2 = 0.85;
        return 3*(1-t)*t**2*p2 + t**3;
    },
    processDelta: function(rawDelta) {
        const abs = Math.abs(rawDelta);
        const sign = Math.sign(rawDelta);
        const normalized = Math.min(abs / this.maxVelocity, 1);
        const curve = abs < this.precisionThreshold ? normalized : this.cubicBezier(normalized);
        return sign * curve * this.maxVelocity;
    }
};

// --- 2. LÓGICA DE INPUT E FILTRO (enginebundle.js) ---
let lastTouchX = null;
let pendingDelta = 0;
let pointerX = window.innerWidth / 2;

function lowPassFilter(input) {
    aimEngine.filteredDelta = aimEngine.filteredDelta + aimEngine.ALPHA * (input - aimEngine.filteredDelta);
    return aimEngine.filteredDelta;
}

const touchArea = document.getElementById('touch-area');
const pointer = document.getElementById('aim-pointer');

touchArea.addEventListener('touchmove', (e) => {
    const touch = e.touches[0];
    if (lastTouchX === null) {
        lastTouchX = touch.clientX;
        return;
    }
    const dx = touch.clientX - lastTouchX;
    lastTouchX = touch.clientX;
    
    // Processamento com Filtro e Bézier
    const filtered = lowPassFilter(dx);
    const finalDelta = aimEngine.processDelta(filtered);
    
    // Move o ponteiro visualmente
    pointerX += finalDelta;
    pointer.style.left = pointerX + 'px';
}, { passive: true });

touchArea.addEventListener('touchend', () => {
    lastTouchX = null;
    aimEngine.filteredDelta = 0;
});

// --- 3. ATUALIZAÇÃO DOS SLIDERS ---
function updateEngine() {
    aimEngine.maxVelocity = parseFloat(document.getElementById('sliderMaxVel').value);
    aimEngine.precisionThreshold = parseFloat(document.getElementById('sliderPrec').value);
    document.getElementById('valMaxVel').innerText = aimEngine.maxVelocity;
    document.getElementById('valPrec').innerText = aimEngine.precisionThreshold;
}

// --- 4. REGISTRO DO SERVICE WORKER (service-worker.js) ---
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').then(() => {
            document.getElementById('status-sw').innerText = 'OFFLINE READY: ACTIVE';
            document.getElementById('status-sw').style.color = '#00f2ff';
        });
    });
}
</script>

</body>
</html>
